# Телеграм бот
Простой универсальный телеграм-бот с шагами, хранящимися в БД
## Стек технологий
<b>1. Основной фреймворк:</b> Java Spring <br>
<b>2. БД:</b> PostgreSQL<br>
<b>3. Работа с БД:</b><br>
- Spring Data JDBC<br>
- Flyway
## Основной функционал:
### 1. Вывод шагов из БД по идентификатору шага
Шаги выводятся из таблицы steps, выбор шага осуществляется по steps_id, полученному из чата или через callback кнопки. <br>
Причина использования БД - попытка сделать универсального бота, настройка которого не потребует частого вмешательства в код.<br>
Для пользователя бота отредактировать шаги в БД достаточно простая задача.

### 2. Вывод callback кнопок после текста шага
Поддерживается вывод callback кнопок, при нажатии на которых бот получает команду, указанную в кнопке.<br>
Старт начального диалога осуществляется вводом любого текста.

### 3. Сохранение вводимой информации от пользователя
Есть возможность сохранить вводимую информация от пользователя в БД, в таблицу data. <br>
Если в таблице steps в столбце regexp не нулевое значение, то на выбранном шаге выполняется проверка введенной информации по указанному регулярному выражению.

### 4. Вывод переменных в тексте шага
Есть поддержка переменных в тексте шага, формат: <br> 
<< xxx >>, где xxx - название переменной <br>
Добавление переменных осуществляется путем добавления классов в пакет variables

### 5. Сброс диалога на начало командой /start
Может осуществляться на любом шаге
Также сброс диалога осуществляется автоматически после достижения последнего шага (метка в поле next, например: end)

---

## Примеры шагов:
### 1. Пример простого информационного шага: <br>
//идентификатор шага <br> 
**id**: /start <br>
//текст шага с переменной << firstname >> <br>
**text**: "Здравствуйте, << firstname >>!  <br>
Мы, Международная Компания ""Noname""! <br>
Если хотите записаться на прием, нажмите <br>
""записаться на прием""" <br>
//блок кнопок в формате json с одной кнопкой и переходом на шаг "/1" по нажатию <br>
**buttons**: " <br>
[ <br>
&nbsp;{ <br>
&nbsp;&nbsp;"text": "ЗАПИСАТЬСЯ НА ПРИЕМ", <br>
&nbsp;&nbsp;"callbackData": "/1" <br>
&nbsp;} <br>
]" <br>
//признак, что на этом шаге ввод данных не требуется <br>
**is_need_to_save**: null  <br>
//следующий шаг /1, поле обязательное для заполнения <br>
**next**: /1 <br>
//Регулярное выражение проверки ввода, так как после этого шага нет ввода данных, поле не заполнено <br>
**regexp**: null

### 2. Пример шага, который требует ввод данных: <br>
//идентификатор шага <br>
**id**: /2 <br>
//текст шага <br>
**text**: "Укажите дату и время вашего визита с *09:00* до *16:30* <br>
(в формате *ДД.ММ.ГГГГ ЧЧ:ММ*) <br>
Например: 01.01.2026 10:00" <br>
//блок кнопок пустой <br>
**buttons**: null
//признак, что после этого шага потребуется сохранение <br>
**is_need_to_save**: true  <br>
//следующий шаг, переход выполнится после ввода данных <br>
**next**: /3 <br>
//Регулярное выражение проверки ввода, данное выражение проверяет что введена корректная дата и время от 09:00 до 16:30 <br>
**regexp**: ^(0[1-9]|[1-2][\d]|3[0-1])\.(0[1-9]|[1][0-2])\.(20[2-9]\d) (09:[0-5][\d]|1[0-5]:[0-5][\d]|16:[0-2][\d]|16:30)$